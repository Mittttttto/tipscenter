/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2016-03-29 13:29:53 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.view;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.app.model.Talk;
import java.util.List;

public final class echo11_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(1);
    _jspx_dependants.put("/title.jsp", Long.valueOf(1459251152010L));
  }

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html>\r\n");
      out.write("<head lang=\"en\">\r\n");
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n");
      out.write("<!-- <html xmlns=\"http://www.w3.org/1999/xhtml\"> -->\r\n");
      out.write("\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n");
      out.write("<title>无标题文档</title>\r\n");
      out.write("<link type=\"text/css\" href=\"main/css/style.css\" rel=\"stylesheet\" />\r\n");
      out.write("<script type=\"text/javascript\" src=\"main/js/jquery-1.9.1.min.js\"></script>\r\n");
      out.write("<script src=\"main/js/jquery.SuperSlide.2.1.1.js\" type=\"text/javascript\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"main/js/public.js\"></script>\r\n");
      out.write("<script>\r\n");
      out.write("\r\n");
      out.write("/* \r\n");
      out.write("function check1(){\r\n");
      out.write("\talert(\"123\");\r\n");
      out.write("    var cid=");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${sessionScope.cid}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(";\r\n");
      out.write("\tvar username=\"mao\";\r\n");
      out.write("\tvar score=");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${sessionScope.score}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(";\r\n");
      out.write(" \tif(username!=null&&username!=\" \"){\r\n");
      out.write(" \t\r\n");
      out.write("\t\t$(\"#tetleUsername\").css('display','inline');\r\n");
      out.write("\t\t$(\"#tetleUsername\").html('您好！'+username+'&nbsp&nbsp');\r\n");
      out.write("\t\t$(\"#uid\").html(cid);\r\n");
      out.write("\t\t$(\"#reg\").css('display','none');\r\n");
      out.write("\t\t$(\"#welcome\").css('display','none');\r\n");
      out.write("\t\t$(\"#login\").css('display','none');\r\n");
      out.write("\t\t$(\"#exit\").css('display','inline');\r\n");
      out.write("\t} \r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("$(document).ready(function(){\r\n");
      out.write("\talert(\"12\");\r\n");
      out.write("}) */\r\n");
      out.write("/* function exit(){\r\n");
      out.write("\t$.get(\"/customer/handle\",{action:\"exit\",date:new Date()},function(mess){\r\n");
      out.write("\t\tif(mess==\"success\"){\t\t\t\r\n");
      out.write("\t\t \twindow.location = \"title.jsp\";\r\n");
      out.write("\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\telse{\r\n");
      out.write("\r\n");
      out.write("\t\t}\r\n");
      out.write("\t});\t\r\n");
      out.write("} */\r\n");
      out.write("</script>\r\n");
      out.write("\r\n");
      out.write("<!--顶部top-->\r\n");
      out.write("<div class=\"topMenu\">\r\n");
      out.write("  <div class=\"indexCont\">\r\n");
      out.write("    <ul class=\"fl tW tL\" style=\"width:320px;\">\r\n");
      out.write("\r\n");
      out.write("       <li class=\"b1\" id=\"welcome\">您好，欢迎来到鱼鱼</li>\r\n");
      out.write("       <li class=\"b1\" id=\"tetleUsername\" style=\"display:none\"></li>\r\n");
      out.write("       ");
String uname=(String)session.getAttribute("uname"); 
      out.write("\r\n");
      out.write("       <li class=\"b2\"><a href=\"/login\" id=\"login\" style=\"color:#FD7306;margin-left:0px; display:");
if(uname!=null){out.print("none");}
      out.write("\">登录</a> \r\n");
      out.write("       ");
if(uname!=null) out.print(uname); 
      out.write("\r\n");
      out.write("       <li id=\"exit\" style=\"margin-left:2px;display:");
if(uname==null) out.print("none"); 
      out.write(";\"><a href='/logout'>注销</a></li>\r\n");
      out.write("  \t   <li id=\"reg\" style=\"margin-left:2px;\"><a href=\"/reg\" >注册</a></li>\r\n");
      out.write(" \r\n");
      out.write("    </ul>\r\n");
      out.write("    <div  class=\"fr\">\r\n");
      out.write("      <ul style=\"float:right;\" id=\"tMenu\" class=\"tW tmCont\">\r\n");
      out.write("       <li> <strong class=\"\"><a href=\"/index\">首页</a></strong></li>\r\n");
      out.write("        <li> <strong class=\"\"><a href=\"/orderlist\">个人中心</a></strong> </li>\r\n");
      out.write("        <li> <strong class=\"/citem?action=cart\"><a href=\"/favorite\">收藏夹</a></strong></li>\r\n");
      out.write("        </li>\r\n");
      out.write("      </ul>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write(" \r\n");
      out.write(" ");
      out.write("\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <script src=\"http://cdn.sockjs.org/sockjs-0.3.min.js\"></script>\r\n");
      out.write("    <!-- 新 Bootstrap 核心 CSS 文件 -->\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css\">\r\n");
      out.write("    <!-- 可选的Bootstrap主题文件（一般不用引入） -->\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css\">\r\n");
      out.write("    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->\r\n");
      out.write("    <script src=\"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js\"></script>\r\n");
      out.write("    <!--<script type=\"text/javascript\" src=\"js/jquery-1.7.2.js\"></script>-->\r\n");
      out.write("    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->\r\n");
      out.write("    <script src=\"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\r\n");
      out.write("    <title>在线聊天</title>\r\n");
      out.write("    <script type=\"text/javascript\">\r\n");
      out.write("       /*  $(function(){\r\n");
      out.write("            var websocket;\r\n");
      out.write("            if ('WebSocket' in window) {\r\n");
      out.write("              \r\n");
      out.write("                websocket = new WebSocket(\"ws://localhost:8080/echo\");\r\n");
      out.write("            } else if ('MozWebSocket' in window) {\r\n");
      out.write("          \r\n");
      out.write("                websocket = new MozWebSocket(\"ws://localhost:8080/echo\");\r\n");
      out.write("            } else {\r\n");
      out.write("                websocket = new SockJS(\"http://localhost:8080/sockjs/echo\");\r\n");
      out.write("            }\r\n");
      out.write("            websocket.onopen = function (evnt) {\r\n");
      out.write("                $(\"#tou\").html(\"链接服务器成功!\")\r\n");
      out.write("            };\r\n");
      out.write("            websocket.onmessage = function (evnt) {\r\n");
      out.write("                $(\"#msg\").html($(\"#msg\").html() + \"<br/>\" + evnt.data);\r\n");
      out.write("            };\r\n");
      out.write("            websocket.onerror = function (evnt) {\r\n");
      out.write("            };\r\n");
      out.write("            websocket.onclose = function (evnt) {\r\n");
      out.write("                $(\"#tou\").html(\"与服务器断开了链接!\")\r\n");
      out.write("            }\r\n");
      out.write("            $('#send').bind('click', function() {\r\n");
      out.write("                send();\r\n");
      out.write("            });\r\n");
      out.write("            function send(){\r\n");
      out.write("                if (websocket != null) {\r\n");
      out.write("                    var message = document.getElementById('message').value;\r\n");
      out.write("                    websocket.send(message);\r\n");
      out.write("                } else {\r\n");
      out.write("                    alert('未与服务器链接.');\r\n");
      out.write("                }\r\n");
      out.write("            }\r\n");
      out.write("        }); */\r\n");
      out.write("        function encodeScript(data) {\r\n");
      out.write("            if(null == data || \"\" == data) {\r\n");
      out.write("                return \"\";\r\n");
      out.write("            }\r\n");
      out.write("            return data.replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\");\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        var socket = new WebSocket(\"ws://localhost:8080/echo\");\r\n");
      out.write("\r\n");
      out.write("        $(function() {\r\n");
      out.write("            //初始化加载listen方法\r\n");
      out.write("            listen();\r\n");
      out.write("        })\r\n");
      out.write("\r\n");
      out.write("        //向客户端发送消息，这里定义了一些参数用来设置消息的颜色字体，不过暂时没用到有兴趣的可以自己实现\r\n");
      out.write("        function emit() {\r\n");
      out.write("\r\n");
      out.write("            //encodeScript方法用来转义<>标签，防止脚本输入，方法内容在core.js里面\r\n");
      out.write("            var text = encodeScript($(\"#msg\").val());\r\n");
      out.write("            if(text!=null&&text!=\"\"){\r\n");
      out.write("            var msg = {\r\n");
      out.write("                \"message\" : text,\r\n");
      out.write("                \"cid1\" :$(\"#cid1\").val(),\r\n");
      out.write("                \"cid2\" :$(\"#cid2\").val(),\r\n");
      out.write("                \"name\" :$(\"#name1\").val(),\r\n");
      out.write("                \"color\" : \"#CECECE\",\r\n");
      out.write("                \"bubbleColor\" : \"#2E2E2E\",\r\n");
      out.write("                \"fontSize\" : \"12\",\r\n");
      out.write("                \"fontType\" : \"黑体\"\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            $.ajax({\r\n");
      out.write("        \t\ttype:'post',//可选get\r\n");
      out.write("        \t\turl:\"/sendtalk\",//这里就是servlet访问的URL\r\n");
      out.write("        \t\tdata: {message: text,cid1:$(\"#cid1\").val(),cid2:$(\"#cid2\").val()}, \r\n");
      out.write("        \t\tdataType:\"text\",\t\r\n");
      out.write("        \t\tsuccess:function(msg){\r\n");
      out.write("        \t\t//这里是ajax提交成功后，程序返回的数据处理函数。msg是返回的数据，数据类型在dataType参数里定义！\r\n");
      out.write("        \t\t\t/* if(msg==\"success\"){\r\n");
      out.write("        \t\t\t \tlayer.msg('消息删除成功',{time:1000});\r\n");
      out.write("        \t\t\t}else{\r\n");
      out.write("        \t\t\t\t layer.msg('不能回复自己的消息',{time:1000});\r\n");
      out.write("        \t\t\t} */\r\n");
      out.write("        \t\t},\r\n");
      out.write("        \t\terror:function(){\r\n");
      out.write("        \t\t}\r\n");
      out.write("        \t})\r\n");
      out.write("            \r\n");
      out.write("            msg = JSON.stringify(msg);\r\n");
      out.write("            //向服务端发送消息\r\n");
      out.write("            socket.send(msg);\r\n");
      out.write("\r\n");
      out.write("            //将自己发送的消息内容静态加载到html上，服务端实现自己发送的消息不会推送给自己\r\n");
      out.write("            $(\"#content\").append(\"<br/><kbd style='color: #\" + \"CECECE\" + \";float: right; font-size: \" + 12 + \";'>\" + text +  \"</kbd><br/>\");\r\n");
      out.write("            //将消息文本框清空\r\n");
      out.write("            $(\"#msg\").val(\"\");\r\n");
      out.write("        \t}\r\n");
      out.write("        }\r\n");
      out.write("\r\n");
      out.write("        function listen() {\r\n");
      out.write("            //打开连接时触发\r\n");
      out.write("            socket.onopen = function() {\r\n");
      out.write("               // $(\"#msg\").val(\"对方加入聊天\");\r\n");
      out.write("                //emit();\r\n");
      out.write("            };\r\n");
      out.write("            //收到消息时触发\r\n");
      out.write("            socket.onmessage = function(evt) {\r\n");
      out.write("                var data = JSON.parse(evt.data);\r\n");
      out.write("             \r\n");
      out.write("                var cid1=data.cid1;\r\n");
      out.write("                \r\n");
      out.write("                var cid2=data.cid2;\r\n");
      out.write("                \r\n");
      out.write("                var check1=$(\"#cid2\").val();\r\n");
      out.write("                var check2=$(\"#cid1\").val();\r\n");
      out.write("                if(check1==cid1&&check2==cid2){\r\n");
      out.write("                $(\"#content\").append(\"<br/><kbd style='color: #\" + data.color + \";font-size: \" + data.fontSize + \";margin-top: 10px;'>\" + data.name + \" : \" + data.message + \"</kbd></br>\");\r\n");
      out.write("                }\r\n");
      out.write("             };\r\n");
      out.write("            //关闭连接时触发\r\n");
      out.write("            socket.onclose = function(evt) {\r\n");
      out.write("                $(\"#content\").append(\"<kbd>\" + \"Close!\" + \"</kbd></br>\");\r\n");
      out.write("                emit();\r\n");
      out.write("            }\r\n");
      out.write("            //连接错误时触发\r\n");
      out.write("            socket.onerror = function(evt) {\r\n");
      out.write("                $(\"#content\").append(\"<kbd>\" + \"ERROR!\" + \"</kbd></br>\");\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        //按下回车键时触发发送消息方法\r\n");
      out.write("        document.onkeydown = function(event){\r\n");
      out.write("            var e = event || window.event || arguments.callee.caller.arguments[0];\r\n");
      out.write("            if(e && e.keyCode == 13){ // enter 键\r\n");
      out.write("                emit();\r\n");
      out.write("            }\r\n");
      out.write("        }; \r\n");
      out.write("    </script>\r\n");
      out.write("\r\n");
      out.write("</head>\r\n");
      out.write(" <body>\r\n");
      out.write("  \t\t");
List<Talk> talks=(List<Talk>)request.getAttribute("talks");
                  Long cid1=(Long)request.getAttribute("cid");
                  String name1=(String)request.getAttribute("name1");
                  String name2=(String)request.getAttribute("name2");
                  Long cid2=null;
                  if(talks.get(0).getCid1()!=cid1){
                	  cid2=talks.get(0).getCid1();
                  }else{
                	  cid2=talks.get(0).getCid2();
                  }
                
      out.write("\r\n");
      out.write("                \r\n");
      out.write("\t    <input type=\"hidden\" id=\"cid1\" name=\"cid1\" value=\"");
      out.print(cid1);
      out.write("\" />\r\n");
      out.write("\t    <input type=\"hidden\" id=\"cid2\" name=\"cid2\" value=\"");
      out.print(cid2 );
      out.write("\" />\r\n");
      out.write("\t     <input type=\"hidden\" id=\"name1\" name=\"name1\" value=\"");
      out.print(name1);
      out.write("\" />\r\n");
      out.write("\t    <input type=\"hidden\" id=\"name2\" name=\"name2\" value=\"");
      out.print(name2 );
      out.write("\" />\r\n");
      out.write("        <div class=\"container\" style=\"padding-top:20px;\">\r\n");
      out.write("            <div class=\"panel panel-primary\">\r\n");
      out.write("                <div class=\"panel-heading\">\r\n");
      out.write("                    <h3 class=\"panel-title\">闲鱼在线聊天</h3>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"panel-body\" id=\"content\">\r\n");
      out.write("                ");
 for(Talk talk:talks){if(talk.getContext()!=null){ 
      out.write("\r\n");
      out.write("                \r\n");
      out.write("               <br/><kbd style='color:#CECECE;font-size:12px;margin-top: 10px;");
if(talk.getCid1()==cid1){out.print(" float: right;");}
      out.write(' ');
      out.write('\'');
      out.write('>');
if(talk.getCid1()==cid2){out.print(name2+"：");} out.print(talk.getContext());
      out.write("</kbd></br>\r\n");
      out.write("                ");
}} 
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            <hr/>\r\n");
      out.write("            <input type=\"text\" class=\"form-control\" placeholder=\"msg\" aria-describedby=\"sizing-addon1\" id=\"msg\">\r\n");
      out.write("            <hr/>\r\n");
      out.write("\r\n");
      out.write("            <hr/>\r\n");
      out.write("            <button type=\"button\" class=\"btn btn-lg btn-success btn-block\" onclick=\"emit()\">Emit</button>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <script type=\"text/javascript\" src=\"http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\"></script>\r\n");
      out.write("        <script type=\"text/javascript\" src=\"http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\r\n");
      out.write("        <script type=\"text/javascript\" src=\"js/core.js\"></script>\r\n");
      out.write("        <script type=\"text/javascript\" src=\"js/index.js\"></script>\r\n");
      out.write("    </body>\r\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
